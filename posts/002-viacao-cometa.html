<!DOCTYPE html><html lang="en"><head><meta name="robots" content="follow, index"/><meta name="description" content="um blog qualquer."/><meta property="og:site_name" content="denis lee | blog"/><meta property="og:description" content="um blog qualquer."/><meta property="og:title" content="denis lee | blog"/><meta property="og:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@denislee"/><meta name="twitter:title" content="denis lee | blog"/><meta name="twitter:description" content="um blog qualquer."/><meta name="twitter:image" content="https://assets.vercel.com/image/upload/q_auto/front/vercel/dps.png"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/><link rel="preload" href="/fonts/Inter-roman.latin.var.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><title>Viação Cometa</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/4a64bba6e2e114daab3e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4a64bba6e2e114daab3e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-90a60b87fd0d5fc150f2.js" defer=""></script><script src="/_next/static/chunks/framework-5e34cdb415ba284ac5a9.js" defer=""></script><script src="/_next/static/chunks/main-8d15616dad332ac01c02.js" defer=""></script><script src="/_next/static/chunks/pages/_app-13d262b466834baec136.js" defer=""></script><script src="/_next/static/chunks/290-83ec1b894e0aea822950.js" defer=""></script><script src="/_next/static/chunks/pages/posts/002-viacao-cometa-a4402bc38d33a1a8e768.js" defer=""></script><script src="/_next/static/BxP5GFZQ3Sor5zGvuLJN_/_buildManifest.js" defer=""></script><script src="/_next/static/BxP5GFZQ3Sor5zGvuLJN_/_ssgManifest.js" defer=""></script><style id="__jsx-791102496">a.jsx-791102496{float:right;}@media screen and (max-width:480px){article.jsx-791102496{padding-top:2rem;padding-bottom:4rem;}}</style></head><body><div id="__next"><article class="container prose prose-sm md:prose"><h1>Viação Cometa</h1><div class="meta-line"><div class="meta"><time>Mon Sep 07 2020</time></div><a class="meta-back" href="/posts">Back</a></div><p>Devido ao Covid-19 e a política de quarentena para amenizar as mortes e a queda do sistema de saúde pública aqui no Brasil, muitos comércios fecharam seu funcionamento. Porém, depois de um tempo, tivemos um afrouxamento da quarentena e a algumas empresas começaram a voltar a funcionar. Porém, aos poucos e com cuidado.</p><p>Uma das categorias de negócios mais afetada foi o transporte. Com a quarentena, não tem muito sentido as pessoas utilizarem transporte no geral, não sendo essencial. Por esse motivo, viagens foram canceladas e futuras passagens impedidas de serem compradas.</p><p>Antes da pandemia aparecer em nossa dimensão, eu estava me encontrando com uma pessoa e, depois de tanto esperar (pacientemente), pude ver que as passagens começaram a serem vendidas novamente. Porém, reparei na minha repetição de entrar no site para verificar a disponibilidade de passagens. E vi a oportunidade de poder automatizar isso. Com isso em mente, surgiu a idéia de criar uma aplicação que faz essa verificação para mim.</p><h2>O Plano</h2><p>O fluxo seria o seguinte:</p><ul><li>verificação de passagens no site</li><li>alertar os horários pelo whatsapp</li></ul><p>Dois passos.</p><h2>O site</h2><p>Imaginei que precisaria fazer o tratamento do HTML do site. Porém, para a minha alegria, isso não seria necessário, uma vez que existe um endpoint que o front consulta, deixando tudo bem mais fácil.</p><p>Logo abaixo dá para ver que um simples GET já é possível receber o JSON com as cidades que a empresa trabalha.</p><pre><code class="language-sh">$ http https://www.viacaocometa.com.br/content/jca/cometa/pt-br/jcr:content.getDestinos.json?origem=467
HTTP/1.1 200 OK
X-Vhost: www.viacaocometa.com.br

{
    &quot;listaLocalidade&quot;: {
        &quot;erro&quot;: {
            &quot;descricaoAlerta&quot;: &quot;&quot;,
            &quot;descricaoErro&quot;: &quot;&quot;,
            &quot;ocorreuAlerta&quot;: false,
            &quot;ocorreuErro&quot;: false,
            &quot;sessionValid&quot;: true
        },
        &quot;lsLocalidade&quot;: [
            {
                &quot;cidade&quot;: &quot;A PRATA&quot;,
                &quot;id&quot;: 443,
                &quot;uf&quot;: &quot;SP&quot;
            },
            {
                &quot;cidade&quot;: &quot;AMERICANA&quot;,
                &quot;id&quot;: 64,
                &quot;uf&quot;: &quot;SP&quot;
            },
            ...
             {
                &quot;cidade&quot;: &quot;ÁGUAS DA PRATA&quot;,
                &quot;id&quot;: 14,
                &quot;uf&quot;: &quot;SP&quot;
            }
        ]
    }
}
</code></pre><p>E então, depois de facilitar muito o meu trabalho retornando um JSON, foi simplesmente configurar como enviar uma mensagem pelo Whatsapp.</p><h2>Whatsapp</h2><p>Para isso, uma galera fez um excelente trabalho de simular todo o Whatsapp Web, deixando só o esforço de chamar uma função para enviar uma mensagem (enviar uma mensagem seria única ação que eu precisaria, uma vez que eu não estou fazendo um bot de conversa).</p><p>Precisei autorizar o uso do meu número (utilizando o QR Code). Após isso, foi só configurar o destinatário e pronto. Nesse caso, eu fiz para mandar mensagem para mim mesmo.</p><p>https://github.com/Rhymen/go-whatsapp</p><p><img src="post-004-msg.webp" alt="mensagem no whatsapp"/></p><p><em>(Como a mensagem fica no WhatsApp)</em></p><h2>CronJob</h2><p>Para fazer a verificação de tempos em tempos pensei em diversas estratégias.</p><p>A primeira estratégia foi em utilizar o:</p><p>https://github.com/robfig/cron</p><p>Porém, para deixar a aplicação cuidar disso, eu precisaria que ele precisasse ficar rodando indefinitivamente. Com o risco da aplicação morrer ou qualquer outra instabilidade acontecer, preferi passar a responsabilidade para o sistema operacional. Nesse caso, o Linux.</p><p>Como o Linux não possui muitos problemas em executar os binários gerados pelo Go, então isso não seria um problema também.</p><h2>Github</h2><p>Para quem tiver curiosidade em verificar o código da aplicação simples que eu fiz, segue o link:</p><p>https://github.com/denislee/viacaocometa-alert</p><small style="display:block;margin-top:8rem" class="jsx-791102496"><time class="jsx-791102496">2021</time> © denis lee.<a href="/feed.xml" class="jsx-791102496">RSS</a></small></article></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/002-viacao-cometa","query":{},"buildId":"BxP5GFZQ3Sor5zGvuLJN_","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>